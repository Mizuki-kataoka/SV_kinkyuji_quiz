<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SVç·Šæ€¥æ™‚å¯¾å¿œã‚¯ã‚¤ã‚º</title>
  <link rel="stylesheet" href="SV_kinkyu1.css">
</head>
<body>
  <div class="container">
    <h1>SVç·Šæ€¥æ™‚å¯¾å¿œã‚¯ã‚¤ã‚º</h1>
    <h2>ãã®ä»–çªç™ºçš„ãªè‡ªç„¶ç½å®³ãŒç™ºç”Ÿç·¨ï¼ˆå…¨3å•ï¼‰</h2>

    <!-- åå‰å…¥åŠ› -->
    <label>
      åå‰ï¼š
      <input id="username" type="text" placeholder="ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ï¼ˆ20æ–‡å­—ä»¥å†…ï¼‰" maxlength="20">
    </label>

    <!-- ã‚¯ã‚¤ã‚ºå‡ºé¡Œã‚¨ãƒªã‚¢ -->
    <div id="quiz"></div>

    <!-- å›ç­”ãƒœã‚¿ãƒ³ -->
    <button id="submit">å›ç­”ã‚’é€ä¿¡</button>

    <!-- çµæœ -->
    <div id="result"></div>

    <!-- ãƒ©ãƒ³ã‚­ãƒ³ã‚° -->
    <h2>ãƒ©ãƒ³ã‚­ãƒ³ã‚°</h2>
    <ol id="ranking"></ol>
    <button id="resetRanking">ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã‚’ãƒªã‚»ãƒƒãƒˆ</button>
  </div>

  <script>
  //â€•â€•â€•â€• å•é¡Œãƒ‡ãƒ¼ã‚¿ â€•â€•â€•â€•
  const questions = [
    { q: 'ã€ãã®ä»–çªç™ºçš„ãªè‡ªç„¶ç½å®³ãŒç™ºç”Ÿã€‘è­¦å ±ç™ºä»¤ã‚„ç½å®³ç™ºç”Ÿæ™‚ã®å¯¾å¿œã®æµã‚Œã¯ï¼Ÿ', 
      choices: ['èº«ã‚’å®ˆã‚‹è¡Œå‹•ã‚’å‘¼ã³ã‹ã‘ã‚‹â¡è­¦å ±è§£é™¤orç½å®³ãŒåã¾ã‚‹ã¾ã§åº—å†…å¾…æ©Ÿ',
      'éå¸¸é€šå ±ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™â¡ãŠå®¢æ§˜ã«åº—å†…ã«ã¨ã©ã¾ã‚‹ã‚ˆã†ä¿ƒã™',
      'èº«ã‚’å®ˆã‚‹è¡Œå‹•ã‚’å‘¼ã³ã‹ã‘ã‚‹â¡åº—èˆ—LINEã§è¥¿è„‡ç¤¾å“¡ãƒ»ç¶±äº•ç¤¾å“¡ã‚’ãƒ¡ãƒ³ã‚·ãƒ§ãƒ³ã—å ±å‘Š',
      'ãŠå®¢æ§˜ã«åº—å†…ã«ã¨ã©ã¾ã‚‹ã‚ˆã†ä¿ƒã™â¡åº—å†…ã®è¢«å®³çŠ¶æ³ã‚’ç¢ºèª'], answer:[0], multiple: false},
      { q: 'ã€ãã®ä»–çªç™ºçš„ãªè‡ªç„¶ç½å®³ãŒç™ºç”Ÿã€‘äººçš„è¢«å®³ã‚„åº—èˆ—ã«é‡å¤§ãªè¢«å®³ãŒã‚ã‚‹å ´åˆã®å¯¾å¿œã®æµã‚Œã¯ï¼Ÿ', 
      choices: ['åº—èˆ—LINEã§è¥¿è„‡ç¤¾å“¡ãƒ»ç¶±äº•ç¤¾å“¡ã‚’ãƒ¡ãƒ³ã‚·ãƒ§ãƒ³ã—å ±å‘Š',
      'åºƒåŸŸé¿é›£æ‰€ã¸è¡Œã','éå¸¸é€šå ±ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™','é¿é›£èª˜å°ã¨å®‰å…¨ç¢ºä¿ã‚’è¡Œã†'], answer:[0], multiple: false},
      { q: 'ã€ãã®ä»–çªç™ºçš„ãªè‡ªç„¶ç½å®³ãŒç™ºç”Ÿã€‘äººçš„è¢«å®³ã‚„åº—èˆ—ã«é‡å¤§ãªè¢«å®³ãŒãªã„å ´åˆã®å¯¾å¿œã®æµã‚Œã¯ï¼Ÿ', 
      choices: ['é¿é›£èª˜å°ã¨å®‰å…¨ç¢ºä¿ã‚’è¡Œã†','è¢«å®³çŠ¶æ³ã‚’ç¢ºèªã—å–¶æ¥­çµ‚äº†','å®‰å…¨ç­‰ã‚’ç¢ºèªã—å–¶æ¥­ã‚’å†é–‹','åº—èˆ—LINEã§è¥¿è„‡ç¤¾å“¡ãƒ»ç¶±äº•ç¤¾å“¡ã‚’ãƒ¡ãƒ³ã‚·ãƒ§ãƒ³ã—å ±å‘Š'], answer: [2], multiple: false}];

  //â€•â€•â€•â€• ãƒ˜ãƒ«ãƒ‘ãƒ¼ â€•â€•â€•â€•
  function shuffleArray(arr) {
    const a = arr.slice();
    for (let i = a.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [a[i], a[j]] = [a[j], a[i]];
    }
    return a;
  }

  //â€•â€•â€•â€• çŠ¶æ…‹ â€•â€•â€•â€•
  let current = 0;
  let score   = 0;
  let history = [];

  //â€•â€•â€•â€• DOMå–å¾— â€•â€•â€•â€•
  const username  = document.getElementById('username');
  const quizEl    = document.getElementById('quiz');
  const submitBtn = document.getElementById('submit');
  const resultEl  = document.getElementById('result');
  const rankEl    = document.getElementById('ranking');
  const resetBtn  = document.getElementById('resetRanking');

  //â€•â€•â€•â€• åˆæœŸåŒ– â€•â€•â€•â€•
  submitBtn.disabled = true;
  renderQuestion();
  renderRanking(JSON.parse(localStorage.getItem('quizRanking_2-1')||'[]'));

  username.addEventListener('input', () => {
    submitBtn.disabled = !username.value.trim();
  });

  submitBtn.addEventListener('click', () => {
    const name = username.value.trim();
    if (!name) return alert('åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');

    const checked = document.querySelectorAll('input[name="choice"]:checked');
    if (!checked.length) return alert('é¸æŠè‚¢ã‚’é¸ã‚“ã§ãã ã•ã„');

    const selected = Array.from(checked).map(c => parseInt(c.value, 10));
    // â†“ã“ã“ã§ä¸€åº¦ã ã‘åˆ†å‰²ä»£å…¥
    const { q, choices, answer, multiple } = questions[current];

    const isCorrect = multiple
      ? (selected.length === answer.length && answer.every(i => selected.includes(i)))
      : (selected[0] === answer[0]);
    if (isCorrect) score++;

    // å±¥æ­´ç™»éŒ²
    history.push({ q, choices, answer, multiple, selected, isCorrect });

    // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ï¼†æ¬¡ç”»é¢
    const cls = isCorrect ? 'correct' : 'wrong';
    quizEl.classList.add(cls);
    quizEl.addEventListener('animationend', () => {
      quizEl.classList.remove(cls);
      current < questions.length? renderQuestion() : finishQuiz();
    }, { once: true });
    current++;
  });

  resetBtn.addEventListener('click', () => {
    if (confirm('ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã‚’æœ¬å½“ã«ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ')) {
      localStorage.removeItem('quizRanking_2-1');
      renderRanking([]);
    }
  });

  //â€•â€•â€•â€• å•é¡Œæç”» â€•â€•â€•â€•
  function renderQuestion() {
    const { q, choices, multiple } = questions[current];
    let html = `<p>${current+1}. ${q}</p>`;
    shuffleArray(choices.map((t,i)=>({t,i}))).forEach(({t,i}) => {
      const type = multiple ? 'checkbox' : 'radio';
      html += `
        <label>
          <input type="${type}" name="choice" value="${i}">
          ${t}
        </label>`;
    });
    quizEl.innerHTML = html;
  }

  //â€•â€•â€•â€• çµ‚äº†å‡¦ç† â€•â€•â€•â€•
  function finishQuiz() {
    const name = username.value.trim();
    let html = `<p>${name} ã•ã‚“ã®ç‚¹æ•°ï¼š<strong>${score}</strong> / ${questions.length}</p>`;

    html += '<h3>å›ç­”çµæœä¸€è¦§</h3><ol>';
    history.forEach((e, idx) => {
      const { q, choices, answer, selected, isCorrect } = e;
      const items = choices.map((txt,i) => {
        let mark = selected.includes(i) && answer.includes(i) ? 'âœ…'
                 : selected.includes(i)               ? 'âŒ'
                 : answer.includes(i)                 ? 'âœ”' : '';
        return `<li style="list-style:none;">${mark} ${txt}</li>`;
      }).join('');
      html += `
        <li>
          <strong>Q${idx+1}:</strong> ${q}
          <ul>${items}</ul>
          <div style="color:${isCorrect?'green':'red'};">${isCorrect?'æ­£è§£':'ä¸æ­£è§£'}</div>
        </li>`;
    });
    html += '</ol>';

      function getComment(score, total) {
  if      (score === total)      return 'ğŸ¤© å®Œç’§ã™ãã‚‹ï¼SVã‚·ãƒ¼ãƒˆã§æœ€çµ‚ç¢ºèªã‚’ã—ã¾ã—ã‚‡ã†ï¼';
  else if (rate >= 1)     return 'ğŸ¤¯ ã“ã‚“ãªã‚¯ã‚¤ã‚ºã‚‚ã§ããªã‹ã£ãŸã‚‰æœ¬å½“ã®SVã«ã¯ä½•ã‚‚è¨€ãˆãªã„ã“ã¨ã§ã—ã‚‡ã†';
  else                      return 'ğŸ’€ ä»Šã™ãSVã‚·ãƒ¼ãƒˆã‚’ãã¾ãªãè¦‹ã¦è¦šãˆã¦ãã ã•ã„';
}
const comment = getComment(score, questions.length);
  html += `<p class="comment">${comment}</p>`;

    resultEl.innerHTML = html;
    updateRanking(name, score);
  }

  //â€•â€•â€•â€• ãƒ©ãƒ³ã‚­ãƒ³ã‚°æ›´æ–° â€•â€•â€•â€•
  function updateRanking(name, score) {
    const key = 'quizRanking_2-1';
    const data = JSON.parse(localStorage.getItem(key) || '[]');
    const ex = data.find(x=>x.name===name);
    if (ex) { if (score>ex.score) ex.score = score; }
    else    { data.push({name,score}); }
    data.sort((a,b)=>b.score-a.score);
    localStorage.setItem(key, JSON.stringify(data));
    renderRanking(data, name, score);
  }

  //â€•â€•â€•â€• ãƒ©ãƒ³ã‚­ãƒ³ã‚°æç”» â€•â€•â€•â€•
  function renderRanking(data, curName, curScore) {
    let html = '', prev = null, rank=0;
    data.forEach((x,i)=>{
      if (x.score !== prev) { rank = i+1; prev = x.score; }
      if (rank>10) return;
      const cls = x.name===curName&&x.score===curScore? ' class="highlight"' : '';
      html += `<li${cls}>${rank}ä½ï¼š${x.name}ï¼ˆ${x.score}ç‚¹ï¼‰</li>`;
    });
    rankEl.innerHTML = html;
  }
  </script>
</body>
</html>